openapi: 3.0.3
info:
  title: Transfer Service API
  description: |
    UPI money transfer service for NPCI payment processing.
    
    This API enables secure, real-time money transfers between UPI accounts with:
    - Balance validation
    - Transaction limits enforcement
    - Idempotency support
    - Audit trail
    - Rate limiting
    
    **Base URL**: `https://api.npci.org.in/v1`
    
    **Authentication**: JWT Bearer token required for all endpoints
    
    **Rate Limits**: 100 requests/minute per user
  version: 1.0.0
  contact:
    name: NPCI API Support
    email: api-support@npci.org.in
  license:
    name: Proprietary
    
servers:
  - url: https://api.npci.org.in/v1
    description: Production server
  - url: https://api-staging.npci.org.in/v1
    description: Staging server
  - url: http://localhost:8080/v1
    description: Local development server

security:
  - bearerAuth: []

tags:
  - name: transfers
    description: Money transfer operations
  - name: transactions
    description: Transaction query operations
  - name: health
    description: Health check endpoints

paths:
  /transfers:
    post:
      tags:
        - transfers
      summary: Initiate money transfer
      description: |
        Transfer money from source UPI account to destination UPI account.
        
        **Idempotency**: Include `Idempotency-Key` header to prevent duplicate transfers.
        
        **Transaction Limits**:
        - Minimum: ₹1
        - Maximum per transaction: ₹1,00,000
        - Daily limit: ₹1,00,000
        - Monthly limit: ₹10,00,000
        
        **Transaction Fee**:
        - ₹0 for amounts ≤ ₹1,000
        - ₹5 for amounts > ₹1,000
      operationId: initiateTransfer
      parameters:
        - name: Idempotency-Key
          in: header
          description: Unique key to prevent duplicate transfers (UUID recommended)
          required: false
          schema:
            type: string
            format: uuid
            example: "550e8400-e29b-41d4-a716-446655440000"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferRequest'
            examples:
              basic_transfer:
                summary: Basic transfer
                value:
                  sourceUPI: "alice@okaxis"
                  destinationUPI: "bob@paytm"
                  amount: 500.00
                  remarks: "Lunch payment"
              high_value_transfer:
                summary: High value transfer with fee
                value:
                  sourceUPI: "alice@okaxis"
                  destinationUPI: "bob@paytm"
                  amount: 5000.00
                  remarks: "Monthly rent"
      responses:
        '200':
          description: Transfer successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransferResponse'
              examples:
                success:
                  value:
                    transactionId: "TXN-20241220-123456"
                    status: "SUCCESS"
                    sourceUPI: "alice@okaxis"
                    destinationUPI: "bob@paytm"
                    amount: 500.00
                    fee: 0.00
                    totalDebited: 500.00
                    timestamp: "2024-12-20T10:30:45.123Z"
                    remarks: "Lunch payment"
        '400':
          description: Bad request - validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                insufficient_balance:
                  value:
                    errorCode: "INSUFFICIENT_BALANCE"
                    message: "Insufficient balance. Available: ₹100, Required: ₹500"
                    timestamp: "2024-12-20T10:30:45.123Z"
                invalid_upi_format:
                  value:
                    errorCode: "INVALID_UPI_FORMAT"
                    message: "UPI ID must be in format: username@bankcode"
                    timestamp: "2024-12-20T10:30:45.123Z"
                amount_below_minimum:
                  value:
                    errorCode: "AMOUNT_BELOW_MINIMUM"
                    message: "Minimum transfer amount is ₹1"
                    timestamp: "2024-12-20T10:30:45.123Z"
                amount_exceeds_limit:
                  value:
                    errorCode: "AMOUNT_EXCEEDS_LIMIT"
                    message: "Maximum per-transaction limit is ₹1,00,000"
                    timestamp: "2024-12-20T10:30:45.123Z"
                daily_limit_exceeded:
                  value:
                    errorCode: "DAILY_LIMIT_EXCEEDED"
                    message: "Daily limit exceeded. Limit: ₹1,00,000, Used: ₹90,000"
                    timestamp: "2024-12-20T10:30:45.123Z"
                same_source_destination:
                  value:
                    errorCode: "SAME_SOURCE_DESTINATION"
                    message: "Cannot transfer to the same account"
                    timestamp: "2024-12-20T10:30:45.123Z"
        '401':
          description: Unauthorized - invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                errorCode: "UNAUTHORIZED"
                message: "Invalid or expired authentication token"
                timestamp: "2024-12-20T10:30:45.123Z"
        '404':
          description: UPI account not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                source_not_found:
                  value:
                    errorCode: "INVALID_SOURCE_UPI"
                    message: "Source UPI ID not found"
                    timestamp: "2024-12-20T10:30:45.123Z"
                destination_not_found:
                  value:
                    errorCode: "INVALID_DESTINATION_UPI"
                    message: "Destination UPI ID not found"
                    timestamp: "2024-12-20T10:30:45.123Z"
        '429':
          description: Too many requests - rate limit exceeded
          headers:
            Retry-After:
              schema:
                type: integer
              description: Number of seconds to wait before retry
              example: 60
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                errorCode: "RATE_LIMIT_EXCEEDED"
                message: "Rate limit exceeded. Try after 60 seconds"
                timestamp: "2024-12-20T10:30:45.123Z"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                service_unavailable:
                  value:
                    errorCode: "SERVICE_UNAVAILABLE"
                    message: "Service temporarily unavailable. Please retry."
                    timestamp: "2024-12-20T10:30:45.123Z"
                transaction_timeout:
                  value:
                    errorCode: "TRANSACTION_TIMEOUT"
                    message: "Transaction timed out. Please check status."
                    timestamp: "2024-12-20T10:30:45.123Z"

  /transactions/{transactionId}:
    get:
      tags:
        - transactions
      summary: Get transaction status
      description: Retrieve details of a specific transaction by transaction ID
      operationId: getTransactionStatus
      parameters:
        - name: transactionId
          in: path
          required: true
          description: Unique transaction identifier
          schema:
            type: string
            pattern: '^TXN-\d{8}-\d{6}$'
            example: "TXN-20241220-123456"
      responses:
        '200':
          description: Transaction details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionDetail'
              examples:
                success_transaction:
                  value:
                    transactionId: "TXN-20241220-123456"
                    status: "SUCCESS"
                    sourceUPI: "alice@okaxis"
                    destinationUPI: "bob@paytm"
                    amount: 500.00
                    fee: 0.00
                    totalDebited: 500.00
                    timestamp: "2024-12-20T10:30:45.123Z"
                    remarks: "Lunch payment"
                failed_transaction:
                  value:
                    transactionId: "TXN-20241220-123457"
                    status: "FAILED"
                    sourceUPI: "alice@okaxis"
                    destinationUPI: "bob@paytm"
                    amount: 500.00
                    fee: 0.00
                    totalDebited: 0.00
                    timestamp: "2024-12-20T10:31:15.456Z"
                    remarks: "Failed due to insufficient balance"
                    errorCode: "INSUFFICIENT_BALANCE"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '404':
          description: Transaction not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                errorCode: "TRANSACTION_NOT_FOUND"
                message: "Transaction with ID TXN-20241220-123456 not found"
                timestamp: "2024-12-20T10:30:45.123Z"
        '500':
          $ref: '#/components/responses/InternalServerError'

  /transactions:
    get:
      tags:
        - transactions
      summary: Get transaction history
      description: Retrieve paginated transaction history for authenticated user
      operationId: getTransactionHistory
      parameters:
        - name: page
          in: query
          description: Page number (zero-indexed)
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
            example: 0
        - name: size
          in: query
          description: Number of records per page
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
            example: 10
        - name: sort
          in: query
          description: Sort order (timestamp,desc or timestamp,asc)
          required: false
          schema:
            type: string
            default: "timestamp,desc"
            example: "timestamp,desc"
        - name: status
          in: query
          description: Filter by transaction status
          required: false
          schema:
            type: string
            enum: [SUCCESS, FAILED, PENDING, REVERSED]
            example: "SUCCESS"
        - name: fromDate
          in: query
          description: Filter transactions from this date (ISO 8601)
          required: false
          schema:
            type: string
            format: date-time
            example: "2024-12-01T00:00:00Z"
        - name: toDate
          in: query
          description: Filter transactions until this date (ISO 8601)
          required: false
          schema:
            type: string
            format: date-time
            example: "2024-12-31T23:59:59Z"
      responses:
        '200':
          description: Transaction history retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransactionHistoryResponse'
              example:
                content:
                  - transactionId: "TXN-20241220-123456"
                    status: "SUCCESS"
                    sourceUPI: "alice@okaxis"
                    destinationUPI: "bob@paytm"
                    amount: 500.00
                    fee: 0.00
                    totalDebited: 500.00
                    timestamp: "2024-12-20T10:30:45.123Z"
                    remarks: "Lunch payment"
                  - transactionId: "TXN-20241219-987654"
                    status: "SUCCESS"
                    sourceUPI: "alice@okaxis"
                    destinationUPI: "charlie@ybl"
                    amount: 1500.00
                    fee: 5.00
                    totalDebited: 1505.00
                    timestamp: "2024-12-19T15:20:30.789Z"
                    remarks: "Monthly subscription"
                page:
                  number: 0
                  size: 10
                  totalElements: 25
                  totalPages: 3
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /health:
    get:
      tags:
        - health
      summary: Health check
      description: Check if service is up and running
      operationId: healthCheck
      security: []  # No authentication required
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "UP"
                timestamp: "2024-12-20T10:30:45.123Z"
                components:
                  database: "UP"
                  redis: "UP"
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
              example:
                status: "DOWN"
                timestamp: "2024-12-20T10:30:45.123Z"
                components:
                  database: "DOWN"
                  redis: "UP"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from authentication service

  schemas:
    TransferRequest:
      type: object
      required:
        - sourceUPI
        - destinationUPI
        - amount
      properties:
        sourceUPI:
          type: string
          description: Source UPI ID
          pattern: '^[a-zA-Z0-9.\-_]+@[a-zA-Z]+$'
          minLength: 5
          maxLength: 50
          example: "alice@okaxis"
        destinationUPI:
          type: string
          description: Destination UPI ID
          pattern: '^[a-zA-Z0-9.\-_]+@[a-zA-Z]+$'
          minLength: 5
          maxLength: 50
          example: "bob@paytm"
        amount:
          type: number
          format: double
          description: Transfer amount in INR
          minimum: 1.00
          maximum: 100000.00
          example: 500.00
        remarks:
          type: string
          description: Optional remarks for the transfer
          maxLength: 100
          example: "Lunch payment"

    TransferResponse:
      type: object
      required:
        - transactionId
        - status
        - sourceUPI
        - destinationUPI
        - amount
        - fee
        - totalDebited
        - timestamp
      properties:
        transactionId:
          type: string
          description: Unique transaction identifier
          pattern: '^TXN-\d{8}-\d{6}$'
          example: "TXN-20241220-123456"
        status:
          type: string
          enum: [SUCCESS, FAILED, PENDING]
          description: Transaction status
          example: "SUCCESS"
        sourceUPI:
          type: string
          description: Source UPI ID
          example: "alice@okaxis"
        destinationUPI:
          type: string
          description: Destination UPI ID
          example: "bob@paytm"
        amount:
          type: number
          format: double
          description: Transfer amount
          example: 500.00
        fee:
          type: number
          format: double
          description: Transaction fee
          example: 0.00
        totalDebited:
          type: number
          format: double
          description: Total amount debited (amount + fee)
          example: 500.00
        timestamp:
          type: string
          format: date-time
          description: Transaction timestamp (ISO 8601)
          example: "2024-12-20T10:30:45.123Z"
        remarks:
          type: string
          description: Remarks for the transfer
          example: "Lunch payment"

    TransactionDetail:
      type: object
      required:
        - transactionId
        - status
        - sourceUPI
        - destinationUPI
        - amount
        - fee
        - totalDebited
        - timestamp
      properties:
        transactionId:
          type: string
          description: Unique transaction identifier
          pattern: '^TXN-\d{8}-\d{6}$'
          example: "TXN-20241220-123456"
        status:
          type: string
          enum: [SUCCESS, FAILED, PENDING, REVERSED]
          description: Transaction status
          example: "SUCCESS"
        sourceUPI:
          type: string
          description: Source UPI ID
          example: "alice@okaxis"
        destinationUPI:
          type: string
          description: Destination UPI ID
          example: "bob@paytm"
        amount:
          type: number
          format: double
          description: Transfer amount
          example: 500.00
        fee:
          type: number
          format: double
          description: Transaction fee
          example: 0.00
        totalDebited:
          type: number
          format: double
          description: Total amount debited
          example: 500.00
        timestamp:
          type: string
          format: date-time
          description: Transaction timestamp
          example: "2024-12-20T10:30:45.123Z"
        remarks:
          type: string
          description: Remarks for the transfer
          example: "Lunch payment"
        errorCode:
          type: string
          description: Error code if transaction failed
          example: "INSUFFICIENT_BALANCE"

    TransactionHistoryResponse:
      type: object
      required:
        - content
        - page
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/TransactionDetail'
        page:
          $ref: '#/components/schemas/PageInfo'

    PageInfo:
      type: object
      required:
        - number
        - size
        - totalElements
        - totalPages
      properties:
        number:
          type: integer
          description: Current page number (zero-indexed)
          example: 0
        size:
          type: integer
          description: Number of records per page
          example: 10
        totalElements:
          type: integer
          description: Total number of records
          example: 25
        totalPages:
          type: integer
          description: Total number of pages
          example: 3

    ErrorResponse:
      type: object
      required:
        - errorCode
        - message
        - timestamp
      properties:
        errorCode:
          type: string
          description: Machine-readable error code
          example: "INSUFFICIENT_BALANCE"
        message:
          type: string
          description: Human-readable error message
          example: "Insufficient balance. Available: ₹100, Required: ₹500"
        timestamp:
          type: string
          format: date-time
          description: Error timestamp
          example: "2024-12-20T10:30:45.123Z"
        details:
          type: object
          description: Additional error details (optional)
          additionalProperties: true

    HealthResponse:
      type: object
      required:
        - status
        - timestamp
      properties:
        status:
          type: string
          enum: [UP, DOWN]
          description: Overall health status
          example: "UP"
        timestamp:
          type: string
          format: date-time
          description: Health check timestamp
          example: "2024-12-20T10:30:45.123Z"
        components:
          type: object
          description: Individual component health status
          additionalProperties:
            type: string
          example:
            database: "UP"
            redis: "UP"

  responses:
    UnauthorizedError:
      description: Unauthorized - invalid or expired token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            errorCode: "UNAUTHORIZED"
            message: "Invalid or expired authentication token"
            timestamp: "2024-12-20T10:30:45.123Z"

    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            errorCode: "INTERNAL_SERVER_ERROR"
            message: "An unexpected error occurred. Please try again later."
            timestamp: "2024-12-20T10:30:45.123Z"
